/*!
 * Authentiq JS snippet v0.0.1
 *
 * Authentiq JS Snippet for adding a button in a website
 *
 *
 * @author Chris Ziogas
 * @website http://authentiq.io
 *
 * @copyright Authentiq 2015
 * @license under MIT (https://github.com/AuthentiqID/authentiq-js/blob/master/LICENSE)
 */

(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";exports.extract=function(e){return e.split("?")[1]||""},exports.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#|&)/,""),e?e.split("&").reduce(function(n,o){var t=o.replace(/\+/g," ").split("="),e=t[0],r=t[1];return e=decodeURIComponent(e),r=void 0===r?null:decodeURIComponent(r),n.hasOwnProperty(e)?Array.isArray(n[e])?n[e].push(r):n[e]=[n[e],r]:n[e]=r,n},{}):{})},exports.stringify=function(e){return e?Object.keys(e).sort().map(function(n){var r=e[n];return Array.isArray(r)?r.sort().map(function(e){return encodeURIComponent(n)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(n)+"="+encodeURIComponent(r)}).join("&"):""};
},{}],2:[function(require,module,exports){
!function(n,e,t){"undefined"!=typeof module?module.exports=t(n,e):"function"==typeof define&&"object"==typeof define.amd?define(t):e[n]=t(n,e)}("radio",this,function(t,e){"use strict";function n(e){return arguments.length?n.$.channel(e):n.$.reset(),n.$}return n.$={version:"0.2",channelName:"",channels:[],reset:function(){n.$.channelName="",n.$.channels=[]},broadcast:function(){var t,n,s,h,i=this.channels[this.channelName].slice(),a=i.length;for(t=0;a>t;t++)n=i[t],"object"==typeof n&&n.length&&(s=n[0],h=n[1]||e),s.apply(h,arguments);return this},channel:function(n){var e=this.channels;return e[n]||(e[n]=[]),this.channelName=n,this},subscribe:function(){var n,e,s=arguments,h=this.channels[this.channelName],i=s.length,t=[];for(n=0;i>n;n++)t=s[n],e="function"==typeof t?[t]:t,"object"==typeof e&&e.length&&h.push(e);return this},unsubscribe:function(){var n,e,s,i=arguments,t=this.channels[this.channelName],c=i.length,a=t.length,h=0;for(n=0;c>n;n++)for(h=0,a=t.length,e=0;a>e;e++)s=e-h,t[s][0]===i[n]&&(t.splice(s,1),h++);return this}},n});
},{}],3:[function(require,module,exports){
"use strict";require("./polyfills.js");var n=require("radio"),e=require("./utils"),t=require("./button"),i=require("./provider"),o=require("./token"),r=require("./session"),a;!function(a,l){a._defaults={_storage:{state:"authentiq.request_state",nonce:"authentiq.request_nonce",id_token:"authentiq.id_token",session_state:"authentiq.session_state"},direct_events:!1,provider:{provider_uri:"https://test.connect.authentiq.io",authorize_path:"/authorize",end_session_path:"/authorize/logout",check_session_iframe:"/authorize/iframe",client_id:""},button:{response_type:"id_token",response_mode:"fragment",redirect_uri:"",scope:"",state:"",nonce:"",display:"modal",prompt:"",ui_locales:"",signed_in:null,display_errors:"",sign_in_text:"Sign in",sign_out_text:"Sign out",sign_out_claim:"first_name name email phone_number",theme:null}},"defaults"in a&&("undefined"!=typeof a.defaults.direct_events&&(a._defaults.direct_events=!0),a._defaults.provider=Object.assign({},a._defaults.provider,a.defaults.provider),a._defaults.button=Object.assign({},a._defaults.button,a.defaults.button),delete a.defaults);var _,p,s,u,d=document.querySelector(".authentiq-snippet");if(d){s=["provider","button"];for(u in s)for(_ in a._defaults[s[u]])p="data-"+_.split("_").join("-"),d.hasAttribute(p)&&(a._defaults[s[u]][_]=d.getAttribute(p));d.hasAttribute("data-direct-events")&&(a._defaults.direct_events=!0)}"/"===a._defaults.provider.provider_uri.substr(-1)&&(a._defaults.provider.provider_uri=a._defaults.provider.provider_uri.slice(0,-1)),s=["authorize_path","end_session_path","check_session_iframe"];for(u in s)"/"!==a._defaults.provider[s[u]][0]&&(a._defaults.provider[s[u]]="/"+a._defaults.provider[s[u]]);if(a.Event=function(e){return n("aq:"+e)},a.subscribe=function(e,t){a.Event(e).subscribe(t)},a.Token=new o,a.Provider=new i,window.opener){window.opener.authentiq&&window.opener.authentiq.handlePopupCallback&&window.opener.authentiq.handlePopupCallback(e.getEventHistory());try{window.close()}catch(c){}return void e.on(window,"load",function(){window.close()})}return window.parent&&window.parent.authentiq&&window.parent.authentiq.handleModalCallback?void window.parent.authentiq.handleModalCallback(e.getEventHistory()):(a.popup_window=l,a.handlePopupCallback=l,a.handleModalCallback=l,a.Button=t,a.Session=new r,e.on(document,"DOMContentLoaded",function(){var i=document.querySelectorAll(".authentiq-button");d&&/(true|yes|1)/i.test((d.getAttribute("data-button")||"").toLowerCase())&&new t(d);for(var n=0,o=i.length;o>n;n++)new t(i[n]);e.fireEventsFromHistory()}),void(module.exports=a))}(window.authentiq=window.authentiq||{});
},{"./button":4,"./polyfills.js":5,"./provider":6,"./session":7,"./token":8,"./utils":9,"radio":2}],4:[function(require,module,exports){
"use strict";function a(i,_){var o,a,u,v=_||{};if("undefined"===i||!i.hasAttribute(n.instance_attribute)){if(this.id=Math.floor(9e3*Math.random())+1e3,t=window.authentiq,d=t._defaults.button,s=t._defaults._storage,p=t._defaults.provider,r=t.Provider,!l){l=!0;var m=document.createElement("style");m.className="authentiq-styles",m.innerHTML=g(),document.getElementsByTagName("head")[0].appendChild(m),e.on(window,"keydown",function(t){27===t.keyCode&&c()})}b.apply(this),this.options=Object.assign({},d,v);for(o in this.options)a="data-"+o.split("_").join("-"),i.hasAttribute(a)&&(this.options[o]=i.getAttribute(a));this.options.sign_in_text===d.sign_in_text&&"script"!==i.tagName.toLowerCase()&&""!==i.innerHTML.trim()&&(this.options.sign_in_text=i.innerHTML.trim());var w=["state","nonce"];for(u in w)""===this.options[w[u]]&&(this.options[w[u]]=e.generateNonce(8));if(""!==this.options.scope&&-1===this.options.scope.indexOf("openid")&&(this.options.scope+=" openid"),""===this.options.redirect_uri)this.options.response_mode="fragment",this.options.redirect_uri=window.location.href.split("#")[0];else if(!/^https?:\/\//i.test(this.options.redirect_uri)){var y="/"!==this.options.redirect_uri[0]?"/":"";this.options.redirect_uri=window.location.origin+y+this.options.redirect_uri}this.options.signed_in=/(true|yes|1)/i.test(this.options.signed_in),"script"===i.tagName.toLowerCase()?(this.scriptTag=i,this.renderButton()):this.el=i,-1===this.el.className.indexOf("authentiq-button")&&(this.el.className+=" authentiq-button"),this.options.theme&&(this.el.className+=" "+this.options.theme+"-theme"),this.el.setAttribute(n.instance_attribute,this.id),this.options.signed_in||r.isSignedIn()?h.apply(this):f.apply(this)}}var m=require("query-string"),e=require("./utils"),t,d,s,p,r,_,o,i,n={instance_attribute:"data-authentiq-button",required_opts:["response_type","response_mode","client_id","redirect_uri","state"],optional_opts:["scope","nonce","display","prompt","ui_locales","display_errors"]},l=!1,u=function(t){var e="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 27'><path id='aq-logo-bg' style='fill:"+t[3]+"' d='M30 18.4c0 .7-.4 1.4-.8 1.7l-13.6 7H14L.8 20c-.4 0-.8-1-.8-1.5v-10C0 8 .4 7.3.8 7L14 0c.4-.3 1.2-.3 1.6 0l13.6 7c.4.2.8 1 .8 1.6v9.8z'/><path id='aq-logo-a' style='fill:"+t[4]+"' d='M11 13.7c0-1.8 1.3-3.3 3-3.3s3 1.5 3 3.3c0 1.8-1.3 3.2-3 3.2s-3-1.7-3-3.5zm11.5 3H22c-.4 0-1-.2-1-.4-.3 0-.5-.4-.5-.8V7.7h-3.2V9c-.5-.5-1-.8-1.7-1-.6-.3-1.5-.5-2.3-.5-1 0-1.7.2-2.4.5-1 .3-1.6.8-2 1.3-.6.6-1 1.2-1 2-.6.7-.7 1.5-.7 2.3 0 1 0 1.7.4 2.4.2.7.6 1.4 1 2 .6.5 1.2 1 2 1.3.6.3 1.4.5 2.3.5 1 0 1.8-.2 2.5-.6.7-.3 1.2-.8 1.7-1.5.3.6.7 1 1.3 1.5.5.4 1 .6 1.8.6.5 0 1 0 1.5-.2l.5-.2v-2.8z'/></svg>";return e.replace(/"/g,"'").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/&/g,"%26").replace(/#/g,"%23").replace(/\s+/g," ")},g=function(){var e,t={basic:["#895fc0","#fff","#6a3fa1","#fff","#f05023"],orange:["#f05023","#fff","#cd380e","#fff","#f05023"],grey:["#afb6bb","#333","#919aa1","#fff","#f05023"],white:["#fff","#444","#d4d4d4","#f05023","#fff"]},i="";i+=".authentiq-button{padding:8px 8px 8px 46px;min-height:40px;background-color:"+t.basic[0]+';background-image:url("data:image/svg+xml;charset=utf8,'+u(t.basic)+'") !important;background-size: 31px 28px !important;background-position: 8px center !important;background-repeat: no-repeat !important;color:'+t.basic[1]+';display:inline-block;border:0 none;border-radius:5px;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;letter-spacing:.016em}.authentiq-button:hover,.authentiq-button:focus{background-color:'+t.basic[2]+";color:"+t.basic[1]+"}";for(e in t)"basic"!=e&&(i+=".authentiq-button."+e+"-theme{background-color:"+t[e][0]+";color:"+t[e][1]+";"+(t.basic[3]!==t[e][3]||t.basic[4]!==t[e][4]?'background-image: url("data:image/svg+xml;charset=utf8,'+u(t[e])+'") !important;':"")+"}.authentiq-button."+e+"-theme:hover,.authentiq-button."+e+"-theme:focus{background-color:"+t[e][2]+";color:"+t[e][1]+"}");return i+=".authentiq-modal{position:fixed;left:0;top:0;width:100%;height:100%;z-index:9998;background-color:rgba(0,0,0,.3);transition:all .8s ease-in-out}#authentiq-session-frame {position:fixed;left:50%;top:50%;width:450px;height:650px;margin-top:-300px;margin-left:-250px;z-index:9999}"},h=function(t){t=t||{};var i,o=this.options.sign_out_claim.split(" "),n=this.options.sign_out_text;for(i in o)if(t[o[i]]){n+=" "+t[o[i]];break}this.el.innerHTML=n,e.off(this.el,"click",r.signOut,this),e.off(this.el,"click",this.signIn,this),e.on(this.el,"click",r.signOut,this)},f=function(){this.el.innerHTML=this.options.sign_in_text,e.off(this.el,"click",r.signOut,this),e.off(this.el,"click",this.signIn,this),e.on(this.el,"click",this.signIn,this)},b=function(){t.Event("profile").subscribe([h,this]),t.Event("concluded").subscribe([f,this])},w=function(e,i){var t="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,o="undefined"!=typeof window.screenY?window.screenY:window.screenTop,n="undefined"!=typeof window.outerWidth?window.outerWidth:document.documentElement.clientWidth,s="undefined"!=typeof window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22,r=0>t?window.screen.width+t:t,a=parseInt(r+(n-e)/2,10),p=parseInt(o+(s-i)/2.5,10);return"width="+e+",height="+i+",left="+a+",top="+p+","},c=function(){"undefined"!=typeof i&&i.parentNode.removeChild(i),i=void 0,o=void 0};a.prototype.authorizeURL=function(){var t,i={},e=n.required_opts.concat(n.optional_opts);for(t in e)n.optional_opts.indexOf(e[t])>-1&&""===this.options[e[t]]||("display"!==e[t]||"modal"!==this.options[e[t]]?i[e[t]]=this.options[e[t]]||p[e[t]]:i[e[t]]="popup");return p.provider_uri+p.authorize_path+"?"+m.stringify(i)},a.prototype.renderButton=function(){this.el=document.createElement("button"),this.scriptTag.parentNode.insertBefore(this.el,this.scriptTag)},a.prototype.signIn=function(n){"undefined"!=typeof n&&n.preventDefault(),localStorage.setItem(s.state,this.options.state,s.state.options),localStorage.setItem(s.nonce,this.options.nonce,s.nonce.options),"page"===this.options.display?window.location.href=this.authorizeURL():"popup"===this.options.display?"undefined"==typeof t.popup_window||t.popup_window.closed?(t.handlePopupCallback=function(i){t.handlePopupCallback=void 0,t.popup_window=void 0,e.setEventHistory(i),e.fireEventsFromHistory()},t.popup_window=window.open(this.authorizeURL(),"Authentiq Connect",w(450,650)+"scrollbars=1,location=0,toolbar=0,status=0,menubar=0,personalbar=0,resizable=0,dependent=1,dialog=0,close=1,modal=1")):t.popup_window.focus():(i=document.createElement("div"),i.className="authentiq-modal",i.onclick=function(){c()},o=document.createElement("iframe"),o.setAttribute("frameBorder","0"),o.id="authentiq-session-frame",o.src=this.authorizeURL(),i.appendChild(o),t.handleModalCallback=function(i){c(),t.handleModalCallback=void 0,e.setEventHistory(i),e.fireEventsFromHistory()},document.body.appendChild(i))},module.exports=a;
},{"./utils":9,"query-string":1}],5:[function(require,module,exports){
Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Function.prototype.bind||(Function.prototype.bind=function(r){function t(){}if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=[].slice,o=e.call(arguments,1),i=this,n=function(){return i.apply(this instanceof t?this:r||window,o.concat(e.call(arguments)))};return t.prototype=this.prototype,n.prototype=new t,n}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var i=Object(e),n=1;n<arguments.length;n++){var t=arguments[n];if(void 0!==t&&null!==t){t=Object(t);for(var a=Object.keys(Object(t)),r=0,u=a.length;u>r;r++){var o=a[r],c=Object.getOwnPropertyDescriptor(t,o);void 0!==c&&c.enumerable&&(i[o]=t[o])}}}return i}});
},{}],6:[function(require,module,exports){
"use strict";function o(e){n=window.authentiq,i=n._defaults._storage,r=n.Token,d=n.Event,p.call(this),d("profile").subscribe([this.updateBindedElements,this]),this.profile()}var f=require("query-string"),e=require("./utils"),n,r,d,i,y,t,s,p=function(){var t,a,s,n,o=["hash","search"];for(var d in o)if(location[o[d]])if(t=f.parse(location[o[d]])||{},"error"in t)e.addEventInHistory("error",{error:t.error,error_description:t.error_description||null});else if("state"in t&&("id_token"in t||"access_token"in t||"code"in t)){a=localStorage.getItem(i.state),t.state===a?("id_token"in t&&(s=localStorage.getItem(i.nonce),n=u(t.id_token),"undefined"!=typeof n&&(r.setToken(t),e.addEventInHistory("authorized:id_token",t.id_token),("undefined"==typeof n.nonce||n.nonce!=s)&&e.addEventInHistory("error",{error:"client_error",error_description:"Invalid nonce in ID Token."}))),"token_type"in t&&"access_token"in t&&e.addEventInHistory("authorized:access_token",{token_type:t.token_type,access_token:t.access_token,expires_in:parseInt(t.expires_in,0)||0}),"code"in t&&e.addEventInHistory("authorized:code",t.code),e.addEventInHistory("authorized",t)):e.addEventInHistory("error",{error:"client_error",error_description:"Invalid state in authorization response."}),localStorage.removeItem(i.state),localStorage.removeItem(i.nonce),"hash"==o[d]&&l();break}},l=function(){var t,n,e=window.location;"pushState"in history?history.replaceState("",document.title,e.pathname+e.search):(t=document.body.scrollTop,n=document.body.scrollLeft,e.hash="",document.body.scrollTop=t,document.body.scrollLeft=n)},u=function(t){var n=t?e.decodeJWT(t):void 0;return n?n.payload:void 0},a=function(){if("undefined"==typeof t&&(t=u(r.getIDToken()),"undefined"!=typeof t)){s=t.exp||void 0;var e=["iss","sub","aud","exp","iat","nbf","auth_time","nonce","acr","amr","azp","jti","at_hash","idp"];e.forEach(function(e){delete t[e]})}if("undefined"!=typeof t){var n=Math.floor(+new Date/1e3);if("undefined"==typeof s||n>=s)return this.signOut(),void c()}return t},c=function(){"undefined"!=typeof n.Session&&n.Session.revokeAccess.bind(n.Session)};o.prototype.isSignedIn=function(){return!!a.apply(this)&&!!r.getSessionState()},o.prototype.profile=function(){var t=a.apply(this);return"undefined"!=typeof t&&e.addEventInHistory("profile",t),t},o.prototype.updateBindedElements=function(){var t,e,n,o=a.apply(this);for(t=document.querySelectorAll("[data-authentiq-profile-bind]"),e=0;e<t.length;++e)n=t[e].dataset.authentiqProfileBind||"",o[n]&&("undefined"!=typeof t[e].value?t[e].value=o[n]:t[e].innerHTML=o[n])},o.prototype.signOut=function(e){"undefined"!=typeof e&&(e.preventDefault(),c()),r.destroy(),t=void 0,d("concluded").broadcast()},module.exports=o;
},{"./utils":9,"query-string":1}],7:[function(require,module,exports){
"use strict";function t(){e=window.authentiq,this.init(),e.Event("concluded").subscribe([this.destroy,this])}var o=require("./utils"),e,i,r,d,s,c=["concluded"],n;t.prototype.init=function(){e.Provider.isSignedIn()&&e.Token.getSessionState()?(e.Event("profile").unsubscribe(this.init),i=e._defaults.provider,r=e.Token,s=i.provider_uri,n=this.renderOPFrame().contentWindow,o.on(window,"message",this.receiveMessage,this)):e.Event("profile").unsubscribe(this.init).subscribe([this.init,this])},t.prototype.destroy=function(){o.off(window,"message",this.receiveMessage,this),this.init()},t.prototype.renderOPFrame=function(){var e,t,s=this.postMessage;if(t=document.querySelector(".opframe"))return t.src=i.provider_uri+i.check_session_iframe,t;e=document.createElement("iframe"),e.setAttribute("frameBorder","0"),e.style.display="none",e.onload=function(){n=this.contentWindow,s()},e.className="opframe",e.src=i.provider_uri+i.check_session_iframe;try{document.body.appendChild(e)}catch(r){o.on(document,"DOMContentLoaded",function(){(document.body||document.documentElement).appendChild(e)})}return e},t.prototype.revokeAccess=function(){this.postMessage("concluded")},t.prototype.postMessage=function(e){var t=i.client_id+" "+r.getSessionState();"undefined"!=typeof e&&c.indexOf(e)>-1&&(t+=" "+e);try{n.postMessage(t,s)}catch(o){}},t.prototype.receiveMessage=function(t){var i;t.origin===s&&t.source==n&&(i=t.data,"changed"===i||"concluded"===i&&e.Provider.signOut())},module.exports=t;
},{"./utils":9}],8:[function(require,module,exports){
"use strict";function e(){o=window.authentiq,t=o._defaults._storage}var s=require("./utils"),o,t,n;e.prototype.setToken=function(e){localStorage.setItem(t.id_token,e.id_token),localStorage.setItem(t.session_state,e.session_state)},e.prototype.getIDToken=function(){return localStorage.getItem(t.id_token)||void 0},e.prototype.getSessionState=function(){return localStorage.getItem(t.session_state)||void 0},e.prototype.destroy=function(){localStorage.removeItem(t.id_token),localStorage.removeItem(t.session_state)},module.exports=e;
},{"./utils":9}],9:[function(require,module,exports){
function o(e){return btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=*$/,"")}function r(e){return e+=Array(5-(e.length%4||4)).join("="),e=e.replace(/\-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(atob(e)))}var n=require("radio"),a,i,e={},t=[];module.exports={log:function(){},on:function(n,t,o,i){var r,a=i?function(e){o.apply(i,[e])}:o;r="getAttribute"in n?n.getAttribute("data-authentiq-button"):n,"undefined"!=typeof r&&("undefined"==typeof e[t]&&(e[t]={}),"undefined"==typeof e[t][r]&&(e[t][r]={}),e[t][r][o]=a),document.addEventListener?n.addEventListener(t,a,!1):document.attachEvent&&n.attachEvent("on"+t,a)},off:function(n,t,o,i){var r,a;r="getAttribute"in n?n.getAttribute("data-authentiq-button"):n,"undefined"!=typeof e[t]&&"undefined"!=typeof e[t][r]&&"undefined"!=typeof e[t][r][o]&&(a=e[t][r][o],document.removeEventListener?n.removeEventListener(t,a,!1):document.detachEvent&&n.detachEvent("on"+t,a),delete e[t][r][o])},addEventInHistory:function(e,r){if(e="aq:"+e,!(!authentiq._defaults.direct_events||window.parent&&window.parent.authentiq&&window.parent.authentiq.handleModalCallback||window.opener&&window.opener.authentiq&&window.opener.authentiq.handlePopupCallback))return void n(e).broadcast(r);var o={name:e,data:r};t.push(o)},setEventHistory:function(e){t=e},getEventHistory:function(){return t},fireEventsFromHistory:function(){if(t.length>0)for(var e in t)n(t[e].name).broadcast(t[e].data);t=[]},generateNonce:function(t){var e=new Uint8Array(t||16);window.crypto.getRandomValues(e);var n=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("");return o(n)},decodeJWT:function(t){var e=t?t.split("."):[];if(3!==e.length)return void n("aq:error").broadcast({error:"client_error",error_description:"Failed to decode ID Token."});var o=e[0],a=e[1],i=e[2],d=JSON.parse(r(o))||void 0,u=JSON.parse(r(a))||void 0;return{header:d,payload:u,signature:i}}};
},{"radio":2}]},{},[3]);
