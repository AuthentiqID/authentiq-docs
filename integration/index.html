<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="The Authentiq team">
        <link rel="canonical" href="http://developers.authentiq.io/integration/">
        <link rel="shortcut icon" href="../images/favicon.png">
        

        <title>Integration - Authentiq Connect</title>

        <link href="../css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono|Anonymous+Pro|PT+Mono|Roboto+Mono|Droid+Sans+Mono|Inconsolata|Fira+Mono|Source+Code+Pro" rel="stylesheet" type="text/css">

        <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Noto+Serif:400|Material+Icons" rel="stylesheet" type="text/css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script src="../js/authentiq.js" 
                class="authentiq-snippet"
                data-client-id="test-js-snippet"></script>

        <script>
            // handle access_token which is needed in `integration` and `client` pages
            authentiq.subscribe('authorized:access_token', function(token) {
                if(typeof token.expires_in !== 'undefined') {
                    var expires_at = new Date();

                    // 60 seconds less to secure browser and response latency
                    expires_at.setSeconds(expires_at.getSeconds() + parseInt(token.expires_in) - 60);
                    
                    token.expires_at = expires_at;
                }

                // store the access_token in localStorage
                localStorage['ngStorage-authentiq.access_token'] = JSON.stringify(token);
            });
        </script>

        

        
    </head>

    <body>
        <div class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">Authentiq Connect</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Overview</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Integration</a>
                </li>
            
            
            
                <li >
                    <a href="../installation/">Installation</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">API Reference <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../api-provider/">Connect</a>
                        </li>
                    
                        <li >
                            <a href="../api-issuer/">Issuer</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../yourapps/">Your Apps</a>
                </li>
            
            
            
                <li >
                    <a href="../faq/">FAQs</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <button class="btn btn-primary navbar-btn authentiq-button"
                        data-response-type="id_token token"
                        data-redirect-uri="/redirect.html"
                        data-scope="openid email~rs aq:name aq:push"
                        data-sign-out-claim="given_name">
                        Sign in
                    </button>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#introduction">Introduction</a></li>
        
            <li><a href="#register-a-client">Register a client</a></li>
        
    
        <li class="main "><a href="#authentiqjs">AuthentiqJS</a></li>
        
            <li><a href="#button">Button</a></li>
        
            <li><a href="#example">Example</a></li>
        
            <li><a href="#options">Options</a></li>
        
            <li><a href="#events">Events</a></li>
        
            <li><a href="#server-side-processing">Server side processing</a></li>
        
    
        <li class="main "><a href="#third-party-integrations">Third-party integrations</a></li>
        
            <li><a href="#hellojs">HelloJS</a></li>
        
            <li><a href="#angularjs">AngularJS</a></li>
        
            <li><a href="#flask">Flask</a></li>
        
    
        <li class="main "><a href="#other-integrations">Other integrations</a></li>
        
            <li><a href="#amazon-aws">Amazon AWS</a></li>
        
            <li><a href="#amazon-cognito">Amazon Cognito</a></li>
        
            <li><a href="#salesforce">SalesForce</a></li>
        
    
    </ul>
</div></div>
                <div id="main" class="col-md-9" role="main">

<h1 id="introduction">Introduction</h1>
<p>[TBD]</p>
<p>This page explains how to allow your users to sign in with Authentiq ID on your website in minutes. It shows how to <a href="#authentiqjs">use AuthentiqJS with both client and server side applications</a>, but also covers how to <a href="#third-party-frameworks">use third-party OAuth 2.0 frameworks with Authentiq Connect</a>.</p>
<p>Authentiq Connect is compatible with both <a href="http://oauth.net/2/">OAuth 2.0</a> and <a href="http://openid.net/">OpenID Connect 1.0 (OIDC)</a>, and as such it should feel familiar to anyone having implemented an OAuth 2.0 authorization flow before. In case your application already accepts users from other OAuth 2.0 identity providers (such as Google, Facebook, &hellip;), it should be easy to enable Authentiq ID as another source of verified users using your existing OAuth 2.0 client implementation.</p>
<p>Alternatively, our <a href="#native-sdk">native Authentiq Connect SDK</a> allows you to implement a rich authentication experience in minutes. We recommend this option if you are looking to enhance your registration and sign-in flows, or want to add strong passwordless two-factor authentication to your website.</p>
<p>There are a few important differences to consider when evaluating integration options.</p>
<p>Our native Authentiq Connect SDK is easy to use and leverages features of OpenID Connect to obtain a rich authentication experience. But our protocol also works with many of the great third-party OAuth 2.0 client libraries out there already. Deciding what works best for you depends heavily on your situation. In practice, generic OAuth 2.0 libraries tend to work well, but will be less optimized in terms of performance and user experience.</p>
<p class="alert alert-success" role="alert">OpenID Connect is an extention to OAuth 2.0 that standardizes user authentication and forms the basis of Authentiq Connect. </p>
<h2 id="register-a-client">Register a client</h2>
<p>[TBD]</p>
<p>Whether or not your integration is going to be native or third-party, you will need to <a href="clients.md">register your application</a> with an Authentiq Connect Provider and obtain a unique client identifier. Use the <code>client_id</code> in your preferred OAuth 2.0 client library, or when customizing your AuthentiqJS snippet below. </p>
<h1 id="authentiqjs">AuthentiqJS</h1>
<p>In terms of user experience, the smoothest integration option is to simply include our AuthentiqJS snippet on your page. You can use the snippet configurator to easily generate cusomtized snippet code for your application, or copy and adjust the example snippet below.</p>
<h2 id="button">Button</h2>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">1. Pick an Authentiq client <small>[Sign in first]</small></h3>
  </div>
  <div class="panel-body">
    <form class="form-inline">
      <div class="form-group col-md-6">
        <label class="sr-only" for="existing-client-id">Select existing client ID</label>
        <select class="form-control" id="existing-client-id" disabled data-authentiq-key="client-id" data-script-opt="1">
          <option value="PLACEHOLDER_CLIENT_ID">Select an existing client ID</option>
        </select>
      </div>
      <a href="#/clients/add" id="add-client-button" class="btn btn-primary disabled" data-toggle="modal" data-angular-link data-target="#add-client">Create new client</a>
    </form>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">2. Button options</h3>
  </div>
  <div class="panel-body">
    <form class="form-horizontal">
      <div class="form-group">
        <label for="opts-display" class="col-sm-2 control-label">Display</label>
        <div class="col-md-4">
          <select class="form-control" id="opts-display" data-authentiq-key="display">
            <option value="">Modal</option>
            <option value="page">Page</option>
            <option value="popup">Popup</option>
          </select>
        </div>
        <label for="opts-theme" class="col-sm-2 control-label">Theme</label>
        <div class="col-md-4">
          <select class="form-control" id="opts-theme" data-authentiq-key="theme">
            <option value="">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label for="opts-sign-in-text" class="col-sm-2 control-label">Sign in text</label>
        <div class="col-md-4">
          <input type="text" id="opts-sign-in-text" class="form-control" placeholder="Sign in" data-authentiq-key="sign_in_text">
        </div>
        <label for="opts-sign-out-text" class="col-sm-2 control-label">Sign out text</label>
        <div class="col-md-4">
          <input type="text" id="opts-sign-out-text" class="form-control" placeholder="Sign out" data-authentiq-key="sign_out_text">
        </div>
      </div>
      <hr />
      <div class="checkbox">
        <label class="control-label">
          <input type="checkbox" value="" data-authentiq-key="direct_events" data-script-opt="1">
          Direct events, will fire any events even before DOM is ready
        </label>
      </div>
    </form>
  </div>
</div>

<div class="well text-center">
  <button id="authentiq" class="authentiq-button">
    Sign in
  </button>
</div>

<!-- Button trigger modal -->

<p><button type="button" id="get-code-button" class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#get-code-modal">Get code!</button></p>
<!-- Modal -->

<div class="modal fade" id="get-code-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Get the code</h4>
      </div>
      <div class="modal-body">
        <p class="lead">1. Copy the script tag in your site <code>&lt;head&gt;</code>.</p>
        <div class="alert alert-info" role="alert">You might have to replace the <code>PLACEHOLDER_CLIENT_ID</code> with your apps' client ID</div>
        <textarea id="script-snippet" class="form-control" rows="2" style="resize: none;" disabled></textarea>
        <hr />
        <p class="lead">2. Copy the button in the position you want it to be displayed.</p>
        <textarea id="button-snippet" class="form-control" rows="3" style="resize: none;" disabled></textarea>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="add-client" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Create a new client</h4>
      </div>
      <div class="modal-body">
        <iframe src="/console.html/#/clients/add" frameborder="0" width="100%" height="100%"></iframe>
      </div>
    </div>
  </div>
</div>

<h2 id="example">Example</h2>
<pre class="codehilite"><code class="language-html5">    &lt;script src=&quot;//cdn.authentiq.io/authentiq.io/1.0/authentiq.js&quot;&gt;&lt;/script&gt;
    &lt;button class=&quot;authentiq-button&quot;
            data-client-id=&quot;62a90b31-db29-4510-adf4-3d4d7d932d14&quot;
            data-provider-uri=&quot;https://connect.authentiq.io/authorize&quot;
            data-scopes=&quot;email~rs aq:name aq:push&quot;&gt;
      Sign in with Authentiq ID
    &lt;/button&gt;</code></pre>


<h2 id="options">Options</h2>
<p>The following <code>data-*</code> attributes are available for the AuthentiqJS <code>&lt;script&gt;</code> and <code>&lt;button&gt;</code> tags.</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td>client-id</td>
<td>Your registered application ID.</td>
<td>None, obtain a unique ID from the <a href="clients.md">Client Console</a>.</td>
</tr>
<tr>
<td>provider-uri</td>
<td>Provider Authorization URL. Change this for <a href="../installation/">self-hosted installs</a>.</td>
<td><code>https://connect.authentiq.io/authorize</code></td>
</tr>
<tr>
<td>scope</td>
<td><a href="..#scopes">Scopes</a> to request from user, as a space-separated list. Append <code>~r</code> to indicate that a scope is required and/or <code>~s</code> to indicate the scope should have a valid signature from a trusted Authentiq Issuer.</td>
<td>The scopes registered as defaults for the application.</td>
</tr>
<tr>
<td>display</td>
<td>Authorization display mode. Valid choices are <code>page</code> (full page redirect), <code>popup</code> (popup window) and <code>modal</code> (modal iframe).</td>
<td><code>modal</code></td>
</tr>
<tr>
<td>prompt</td>
<td>Preferred prompt method in Authentiq ID. Valid choices are <code>login</code> and <code>consent</code>. Providing <code>consent</code> essentially overrides <em>One click sign-in</em> and always prompts user for consent.</td>
<td><code>login</code></td>
</tr>
<tr>
<td>response-type</td>
<td>OIDC response type. Valid options are <code>id_token</code>, <code>code</code> and <code>code id_token</code>. You will want to use <code>id_token</code> for client-side apps and <code>code id_token</code> for server-side or hybrid applications. Please make sure that your app is registered with the correct application type.</td>
<td><code>id_token</code></td>
</tr>
<tr>
<td>response-mode</td>
<td>OIDC response mode. Valid options are <code>query</code> and <code>fragment</code>. Can usually be left alone, unless you need need to bypass AuthentiqJS and redirect directly to a server endpoint; in that case manually select <code>query</code>.</td>
<td>Usually <code>fragment</code>.</td>
</tr>
<tr>
<td>redirect-uri</td>
<td>OAuth 2.0 redirect URL. Unless you need to redirect to a server side endpoint you can leave this alone and let AuthentiqJS use the URL of the current page.</td>
<td>The current page, from <em>window.href.location</em>.</td>
</tr>
<tr>
<td>state</td>
<td>Client application state to prevent <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross site request forgeries (XSRF)</a>. To support <a href="http://caniuse.com/#feat=getrandomvalues">older browsers</a> it is possible to pass in a server generated nonce.</td>
<td>32 bytes from <em>crypto.getRandomValues()</em>.</td>
</tr>
<tr>
<td>client-response-uri</td>
<td>URL to POST the received authorization response to for server side validation or processing. Method should return 200 or 400. This parameter is only used when <code>response_mode=fragment</code>, since otherwise .</td>
<td>None</td>
</tr>
</tbody>
</table>
<h2 id="events">Events</h2>
<p>AuthentiqJS allows you to subscribe to a number of events during the authentication flow.</p>
<table>
<thead>
<tr>
<th>Event name</th>
<th>Description</th>
<th>Callback parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>authorized</code></td>
<td>Emitted after successful authentication.</td>
<td>An object containing the URL fragments the provider sent upon successful authentication, e.g. one or more of <code>code</code>, <code>id_token</code>, <code>access_token</code>, <code>expires_in</code>, <code>expires_at</code> and <code>state</code>.</td>
</tr>
<tr>
<td><code>authorized:code</code></td>
<td>Emitted after successful authentication when the response included an authorization code as is the case with response type <code>code</code> or <code>code id_token</code>.</td>
<td>The authorization <code>code</code> received from the provider.</td>
</tr>
<tr>
<td><code>authorized:access_token</code></td>
<td>Emitted after successful authentication when the response included an access token as is the case with response type <code>token</code> or <code>token id_token</code>.</td>
<td>The <code>access_token</code> and <code>expires_in</code> values returned by the provider.</td>
</tr>
<tr>
<td><code>authorized:id_token</code></td>
<td>Emitted after successful authentication when the response included an ID Token as is the case with response type <code>id_token</code> or <code>code id_token</code>.</td>
<td>The un-decoded <code>id_token</code> as a JWT.</td>
</tr>
<tr>
<td><code>profile</code></td>
<td>Emitted after successful authentication when the response included an ID Token the token was validated and decoded successfully.</td>
<td>The decoded <code>id_token</code> object.</td>
</tr>
<tr>
<td><code>concluded</code></td>
<td>Emitted when the authentication session was concluded by the user signing out on the website, or terminating the session from the Authentiq ID mobile app.</td>
<td>N/A</td>
</tr>
<tr>
<td><code>error</code></td>
<td>Emitted when an error occurs. Possible errors are liste. Note that depending on the <a href="#ss"><code>show_errors</code> option</a> the error may have already been shown to the user by the provider. In this case, you may still find this event useful to silently gather error statistics.</td>
<td>The <code>error</code> code and <code>error_description</code> as defined by the OAuth 2.0, OIDC or Bearer Token RFCs.</td>
</tr>
</tbody>
</table>
<h3 id="example_1">Example</h3>
<p>To subscribe to an event, use a pattern like the following.</p>
<p class="alert alert-danger" role="alert">Q: Is there no way to run this normally (i.e. not after DOMContentLoaded)? <br /></p>
<pre class="codehilite"><code>&lt;script&gt;
  document.addEventListener('DOMContentLoaded', function() {

    authentiq.subscribe('profile', function(profile) {

      // Profile
      // {
      //   &quot;scope&quot;: &quot;email aq:name&quot;,
      //   &quot;name&quot;: &quot;George Orwell&quot;,
      //   &quot;given_name&quot;: &quot;George&quot;,
      //   &quot;family_name&quot;: &quot;Orwell&quot;,
      //   &quot;email&quot;: &quot;george@1984.net&quot;,
      //   &quot;email_verified&quot;: false
      // }

    });

    authentiq.subscribe('error', function(error) {

      // Error
      // {
      //   &quot;error&quot;: &quot;client_error&quot;,
      //   &quot;error_description&quot;: &quot;Invalid state parameter&quot;
      // }

    });

  }, false);
&lt;/script&gt;</code></pre>


<p>You can see how events work in another <a href="../examples/events.html">live example</a>.</p>
<p class="alert alert-info" role="alert">The code that subscribes to the events must be placed before the AuthentiqJS script tag itself.</p>
<h2 id="server-side-processing">Server side processing</h2>
<p>If the response mode is set to <code>fragment</code> (recommended), then <code>client_response_uri</code> can be used to still proxy the authorization response to your backend servers, as if you had specified <code>query</code> response mode. The backend server may do one or more of the following tasks:  </p>
<ul>
<li>Validate the ID Token, if present, using cryptographic functions available on the server and return a 400 response in case of a validation error.</li>
<li>Consume the authorization code, if present, and exchange it for an access and/or refresh token at the Authentiq Connect token endpoint.</li>
</ul>
<p>The endpoint should return one of the following status codes. </p>
<table>
<thead>
<tr>
<th>HTTP status code</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>Token validated; the success callback will be called.</td>
</tr>
<tr>
<td>400</td>
<td>Token error; a message will be displayed and the error callback invoked.</td>
</tr>
</tbody>
</table>
<h1 id="third-party-integrations">Third-party integrations</h1>
<p>TBD</p>
<table>
<thead>
<tr>
<th>Typical option</th>
<th>What to fill in</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>client_id</code></td>
<td>The client_id you obtained above.</td>
</tr>
<tr>
<td><code>scope</code></td>
<td>Space delimited list of <a href="..#scopes">Authentiq Connect scopes</a>.</td>
</tr>
<tr>
<td><code>redirect_uri</code></td>
<td>The URL in <em>your</em> application that the Provider should redirect to after authenticating a user.</td>
</tr>
<tr>
<td><code>authorize_uri</code></td>
<td><code>https://connect.authentiq.io/authorize</code></td>
</tr>
<tr>
<td><code>token_uri</code></td>
<td><code>https://connect.authentiq.io/token</code></td>
</tr>
<tr>
<td><code>userinfo_uri</code></td>
<td><code>https://connect.authentiq.io/userinfo</code></td>
</tr>
</tbody>
</table>
<h2 id="hellojs">HelloJS</h2>
<p>There is a <a href="https://github.com/skion/hello.js">fork of HelloJS</a> that includes an <a href="https://github.com/skion/hello.js/blob/master/src/modules/authentiq.js">Authentiq Connect plugin</a>. HelloJS abstracts away the implementation differences between a large number of standard OAuth 2.0 identity providers. We&rsquo;ll aim to get Authentiq Connect included as a supported provider soon.</p>
<h2 id="angularjs">AngularJS</h2>
<p>At least two OAuth 2.0 modules exist for AngularJS, both of which have been tested to work with Authentiq Connect.</p>
<ul>
<li><a href="https://github.com/andreareginato/oauth-ng/blob/master/README.md">OAuth-ng</a> </li>
<li><a href="https://github.com/seegno/angular-oauth2">Angular-OAuth</a></li>
</ul>
<h2 id="flask">Flask</h2>
<p>There are several authentication extensions for Flask&hellip; [TBD]</p>
<h1 id="other-integrations">Other integrations</h1>
<p>As support for OpenID Connect increases, we expect to see more and more sites that will allow administrators to configure external OIDC identity provider for user authentication, vastly improving the ecosystem for Authentiq ID integrations as well. We already see companies like Amazon and SalesForce making this possible.   </p>
<h2 id="amazon-aws">Amazon AWS</h2>
<p>Amazon allows an administrator to configure an external OpenID Connect identity provider as a source for their <a href="http://aws.amazon.com/">AWS</a> console. We&rsquo;re planning to supporting this integration at a later stage so that teams will be able to sign in to AWS using their Authentiq ID. </p>
<h2 id="amazon-cognito">Amazon Cognito</h2>
<p>Amazon allows mobile app developers to configure <a href="http://aws.amazon.com/cognito/">Cognito</a> with external OpenID Connect identity providers, enabling an app to authenticate users from social networks and a variety of sources. We&rsquo;re planning to supporting this integration at a later stage so that mobile app developers will be able to register and authenticate users by their Authentiq ID. </p>
<h2 id="salesforce">SalesForce</h2>
<p><a href="http://salesforce.com/">SalesForce</a> allows an administrator configure up an external OpenID Connect identity provider as a source for company employees. We&rsquo;re planning to supporting this integration at a later stage so that companies will be able to let their employees sign into SalesForce using their Authentiq ID.</p>
<style>
  .progress-bar-anim {
    -webkit-transition: width 2.6s ease;
         -o-transition: width 2.6s ease;
            transition: width 2.6s ease;
  }
</style>

<script>
  (function(aq, $){
    // Whole-script strict mode syntax
    'use strict';

    function generate_button() {
      var $button = $('#authentiq'),
          opts = {},
          button, key, val, text;

      text = $('[data-authentiq-key="sign_in_text"]').val() || 'Sign in';

      $button.replaceWith('<button id="authentiq" class="authentiq-button">' + text + '</button>');
      $button = $('#authentiq');

      // $button.removeData('authentiq-button');

      $('[data-authentiq-key]').each(function(index){
        key = $(this).data('authentiq-key');
        val = $(this).val();

        if (val != '') {
          opts[key] = val;
        }
      });

      button = new authentiq.Button($button[0], opts);
    }

    function fetch_clients(callback) {
      var token = JSON.parse(localStorage['ngStorage-authentiq.access_token'] || '{}');
      if (typeof token.access_token !== 'undefined' && !!token.expires_at && new Date(token.expires_at) > new Date()) {

        var base_url = authentiq._defaults.provider.base_url || 'https://connect.authentiq.io';

        $.ajax({
          url: base_url + '/client',
          headers: {
            'Authorization': token.token_type + ' ' + token.access_token
          },
          dataType: 'json'
        })
        .done(function(data) {
          var select = $('#existing-client-id');

          // clear old entries
          select.html('');

          if (data.length > 0) {
            $.each(data, function(key, client) {
              select.append(
                            $('<option></option>')
                              .attr('value', client.client_id)
                              .text(client.client_name));
            });

            select.prop('disabled', false);
          } else {
            select.append(
                            $('<option></option>')
                              .attr('value', 'PLACEHOLDER_CLIENT_ID')
                              .text('No clients found'));
          }

          if (typeof callback !== 'undefined') {
            callback();
          }
        })
        .fail(function() {
          console.info('Clients can\'t be loaded');
        });
      }
    }

    function console_iframe_loaded() {

      var self = $('#add-client');
      var iframe = self.find('iframe').contents();
      var app = iframe.find('#app');
      self.find('iframe').css('height', app.height());

      app.find('.page-header').hide();

      iframe.find('.progress').hide().find('.progress-bar').width('0%');
      app.show();

      app.on('click', '#save-button', function(){
        app.hide();
        iframe.find('.progress').show().find('.progress-bar').addClass('progress-bar-anim').width('100%');
        self.find('iframe').css('height', '50px');

        // wait a bit for
        setTimeout(function() {
          self.modal('hide');

          self.find('.progress').remove();
          self.find('.modal-body').children().show();

          fetch_clients(function(){
            $('#existing-client-id option:last-child').attr('selected', 'selected');
          });
        }, 3000);
      });

      app.on('click', '#cancel-button', function(){
        self.modal('hide');
      });
    };
    aq.console_iframe_loaded = console_iframe_loaded;

    authentiq.subscribe('profile', function(profile) {
      $('#add-client-button').removeClass('disabled');

      // redirect iframe to add view
      $('#add-client iframe')[0].contentWindow.location.hash = '/clients/add';

      fetch_clients();
    });

    authentiq.subscribe('concluded', function() {
      $('#existing-client-id').prop('disabled', true);
      $('#add-client-button').addClass('disabled');
    });

    $(function() {
      if (!authentiq.Provider.isSignedIn()) {
        $('#existing-client-id').prop('disabled', true);
      }

      $('[data-authentiq-key]').on('change', function(){
        // handle checkbox options
        if ($(this).is(':checkbox')) {
          $(this).val($(this).is(':checked') ? '1' : '');
        }

        generate_button();
      });

      generate_button();


      $('#add-client')
        .on('show.bs.modal', function(e) {
          console_iframe_loaded();
        })  

        .on('hidden.bs.modal', function(e) {
          $(this).find('iframe')[0].contentWindow.location.hash = '/clients/add';
        });

      $('#get-code-modal').on('show.bs.modal', function(e) {
        var button_opts = {}, script_opts = {},
          key, val, opt, code = '', button_text;

        $('[data-authentiq-key]').each(function(index){
          key = $(this).data('authentiq-key');
          val = $(this).val();

          if (val != '') {
            if ($(this).attr('data-script-opt')) {
              script_opts[key] = val;
            } else {
              button_opts[key] = val;
            }
          };
        });

        for (opt in script_opts) {
          code += ' data-' + opt.split('_').join('-') + '="' + script_opts[opt] + '"';
        }

        $('#script-snippet').html('&lt;script src="authentiq-js/authentiq.js"' + code +
          '&gt;&lt;/script&gt;');

        code = '';
        for (opt in button_opts) {
          code += ' data-' + opt.split('_').join('-') + '="' + button_opts[opt] + '"';
        }

        button_text = $('[data-authentiq-key="sign_in_text"]').val() || 'Sign in';

        $('#button-snippet').html('&lt;button' + code +
          '&gt;' + button_text + '&lt;/button&gt;');

        // $(this).find('.modal-content #script-snippet').html('ds');
      });

      // $('#add-client-button').trigger('click');
    });
  })(window.authentiq = window.authentiq || {}, jQuery);
</script></div>
               
        </div>

        <hr>
        <footer class="col-md-12">
            <ul class="text-center list-inline">
                <li>
                    <iframe src="https://ghbtns.com/github-btn.html?user=AuthentiqID&amp;repo=authentiq-docs&amp;type=watch&amp;count=false" width="50" height="20" title="Edit on GitHub" style="overflow: hidden; border: 0;"></iframe>
                </li>
                <li>
                    <a href="https://twitter.com/AuthentiqID" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false" data-dnt="true">Follow @AuthentiqID</a>
                </li>
                <li>
                    <a href="https://twitter.com/intent/tweet?screen_name=AuthentiqID&text=Help%20me%20understand..." class="twitter-mention-button" data-dnt="true">Tweet to @AuthentiqID</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </li>
            </ul>

            
                <center><small><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/AuthentiqID/authentiq-docs" rel="dct:source">Authentiq Connect Developer Documentation</a></span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</small></center>
            
        </footer>

        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <script src="../js/tota11y.min.js"></script>
        </body>
</html>